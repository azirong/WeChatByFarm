<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>登录</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/css/bootstrap-select.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/js/bootstrap-select.min.js"></script>
    <link href="/css/common.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
    <style>
        .top-bar {
            width: 100%;
            height: 20%;
            position: relative;
            left: 0;
            top: 0;
        }
        .top-bar .title {
            font-family: "微软雅黑";
            font-size: 2.5rem;
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            margin: auto;
            text-align: center;
        }
        .user-info {
            width: 75%;
            position: relative;
            left: 0;
            right: 0;
            margin: auto;
        }
    </style>
</head>
<body class="bg-grey">

<div class="top-bar">
    <div class="title">农业大棚管理系统</div>
</div>
<hr>

<form class="user-info" onSubmit="return checkMessage()">
    <div class="form-group">
        <label for="userName"><span class="glyphicon glyphicon-user"></span>&nbsp;&nbsp;用户名</label>
        <input name="userName" class="form-control" id="userName" >
    </div>
    <div class="form-group">
        <label for="telephone"><span class="glyphicon glyphicon-phone"></span>&nbsp;&nbsp;手机号</label>
        <input name="telephone" class="form-control" id="telephone" >
    </div>
    <div class="form-group">
        <label for="password"><span class="glyphicon glyphicon-lock"></span>&nbsp;&nbsp;密码</label>
        <input name="password" class="form-control" id="password" >
    </div>
    <div class="form-group">
        <button type="submit" class="btn btn-success" id="submit" >登录</button>
        <a href="/signup" style="margin-top: 10px;float: right">< 注册</a>
    </div>
</form>


<script>
    $(function () {
        $.getJSON('/city.json', function (data) {
            var cityData = data.info;

            for (var i = 0; i < cityData.length; i++) {
                var tempData = cityData[i];
                if (tempData.childList.length === 1) {
                    $("#cities").append("<option value='" + tempData.id + "'>" + tempData.areaname + "</option>");
                }
                else {
                    for (var j = 0; j < tempData.childList.length; j++) {
                        $("#cities").append("<option value='" + tempData.childList[j].id + "'>" + tempData.childList[j].areaname + "</option>");
                    }
                }
            }

            $('#cities').selectpicker('refresh');
            $('#cities').selectpicker('render');
        })
    })

    //点击注册时，判断用户输入是否正确
    function checkMessage() {
        var userName = $('#userName').val().trim();
        var password = $('#password').val().trim();
        var telephone = $('#telephone').val().trim();

        if (!userName || !password || !telephone) {
            alert("请填写完整信息！");
            return false;
        }
        else if (!checkMobile(telephone)) {
            alert("请输入正确d手机号格式");
            $('#telephone').focus();
            return false;
        }
        else {

//            $.ajax({
//                url: "users/addFarmData",
//                type: 'post',
//                data: {
//                    temperature: '0',
//                    humidity: '0',
//                    light: '0',
//                    carbon: '8'
//                },
//                dataType: 'text',
//                success: function(data) {
//                    console.log("farmdata is add success")
//                },
//                error: function (data) {
//                    console.log('error')
//                }
//            })

            $.ajax({
                url: "/addFarmData",
                type: 'post',
                data: {
                    temperature: 'aaaaa',
                    humidity: '1',
                    light: '1',
                    carbon: '1'
                },
                dataType: 'text',
                cache: false,
                success: function(msg) {
                    console.log(msg)
                },
                error: function (msg) {
                    console.log('error')
                }
            });

            return false;
        }
    }

    function checkMobile(number){
        if(!(/^1[3|4|5|8][0-9]\d{4,8}$/.test(number))){
            return false;
        }
        return true;
    }
</script>
</body>
</html>